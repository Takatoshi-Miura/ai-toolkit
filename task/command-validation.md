# コマンドのテンプレート整合性チェックタスク

## 概要
スラッシュコマンドファイルとタスクファイルが、テンプレートに準拠しているかをチェックする共通タスク。
create-command、update-command から呼び出される。

## コマンドタイプの判定

スラッシュコマンドには2つのタイプがある：

| タイプ | 判定条件 | 特徴 |
|--------|---------|------|
| **自己完結型** | `task/` への参照パスを含まない | 手順がコマンド内に直接記載 |
| **タスク参照型** | `task/` への参照パスを含む | 手順を外部タスクファイルで管理 |

## チェック項目

### スラッシュコマンドファイル（共通）

#### 必須項目
- [ ] フロントマターが `---` で囲まれているか
- [ ] `allowed-tools` が存在するか
- [ ] `description` が存在するか
- [ ] `# 役割` セクションが存在するか
- [ ] `日本語で回答すること。` が含まれているか

#### 推奨項目
- [ ] `## 前提条件` セクションが存在するか
- [ ] `## 出力フォーマット` セクションが存在するか
- [ ] `## 注意事項` セクションが存在するか

### 自己完結型コマンド（追加チェック）
- [ ] `# 手順` セクションが存在するか
- [ ] `## Phase X:` 形式のフェーズ構造があるか（複雑なタスクの場合）
- [ ] 各フェーズに具体的な手順が記載されているか

### タスク参照型コマンド（追加チェック）
- [ ] `# 手順` セクションが存在するか
- [ ] タスクファイルへの参照パスが正しいか
- [ ] 参照先のタスクファイルが実際に存在するか

### タスクファイル（タスク参照型の場合のみ）
- [ ] `# {タイトル}` 形式のタイトルがあるか
- [ ] `## 概要` セクションが存在するか
- [ ] `## 手順` セクションが存在するか
- [ ] `## Phase X:` 形式のフェーズ構造があるか（推奨）

### 命名規則
- [ ] ファイル名がkebab-caseか
- [ ] スラッシュコマンドとタスクファイルの名前が一致しているか（タスク参照型の場合）

## 手順

1. **対象ファイルのパスを受け取る**
   - スラッシュコマンドファイル: `~/Documents/Git/ai-toolkit/slash-commands/{command_name}.md`
   - タスクファイル: `~/Documents/Git/ai-toolkit/task/{command_name}.md`（存在する場合）

2. **コマンドタイプを判定する**
   - スラッシュコマンドファイル内に `task/` への参照があるかを確認
   - 参照がある場合は「タスク参照型」、ない場合は「自己完結型」

3. **スラッシュコマンドファイルの共通チェックを実施**
   - フロントマター形式の確認
   - 必須項目（allowed-tools, description）の存在確認
   - 必須セクション（役割）の存在確認
   - 「日本語で回答すること。」の記載確認
   - 推奨項目（前提条件、出力フォーマット、注意事項）の存在確認

4. **タイプ別の追加チェックを実施**

   **自己完結型の場合:**
   - 手順セクションの存在確認
   - Phase構造の確認（複雑なタスクの場合は推奨）
   - 各フェーズの具体性確認

   **タスク参照型の場合:**
   - 手順セクションの存在確認
   - タスクファイルへの参照パスの正確性確認
   - 参照先タスクファイルの存在確認
   - タスクファイルのチェック（タイトル、概要、手順、Phase構造）

5. **命名規則のチェックを実施**
   - kebab-case準拠の確認
   - ファイル名の一致確認（タスク参照型の場合）

6. **チェック結果を以下の形式で出力する**

   ```
   ### テンプレート整合性チェック結果

   #### コマンドタイプ
   - タイプ: [自己完結型 / タスク参照型]

   #### スラッシュコマンドファイル（必須項目）
   - [OK/NG] フロントマター形式（---で囲まれている）
   - [OK/NG] allowed-toolsが存在する
   - [OK/NG] descriptionが存在する
   - [OK/NG] 役割セクションが存在する
   - [OK/NG] 「日本語で回答すること。」が含まれている
   - [OK/NG] 手順セクションが存在する

   #### スラッシュコマンドファイル（推奨項目）
   - [OK/SKIP] 前提条件セクションが存在する
   - [OK/SKIP] 出力フォーマットセクションが存在する
   - [OK/SKIP] 注意事項セクションが存在する

   #### タイプ別チェック
   【自己完結型の場合】
   - [OK/SKIP] Phase構造が存在する
   - [OK/SKIP] 各フェーズに具体的な手順がある

   【タスク参照型の場合】
   - [OK/NG] タスクファイルへの参照パスが正しい
   - [OK/NG] 参照先タスクファイルが存在する

   #### タスクファイル（タスク参照型のみ）
   - [OK/NG] タイトル形式が正しい
   - [OK/NG] 概要セクションが存在する
   - [OK/NG] 手順セクションが存在する
   - [OK/SKIP] Phase構造が存在する

   #### 命名規則
   - [OK/NG] ファイル名がkebab-case
   - [OK/NG/N/A] スラッシュコマンドとタスクファイルの名前が一致
   ```

## 判定基準

| 判定 | 意味 |
|------|------|
| OK | チェック項目を満たしている |
| NG | 必須項目を満たしていない（修正必要） |
| SKIP | 推奨項目だが未実装（警告として報告） |
| N/A | 該当タイプでは適用されない |

## 参考テンプレート

チェック基準となるテンプレートファイル:
- スラッシュコマンド: `~/Documents/Git/ai-toolkit/templates/slash-command-template.md`
- タスクファイル: `~/Documents/Git/ai-toolkit/templates/task-template.md`
- サブエージェント: `~/Documents/Git/ai-toolkit/templates/agent-template.md`
- Skills: `~/Documents/Git/ai-toolkit/templates/skill-template.md`
