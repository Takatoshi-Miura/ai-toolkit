# update-command コマンド用タスク

## 概要
既存のカスタムスラッシュコマンドを対話形式で更新・改善する。テンプレートとの整合性を保ちながら、ユーザーの要件に応じてスラッシュコマンドファイルとタスクファイルを編集する。

## 手順

### Phase 1: 対象コマンドの選択

1. 既存のスラッシュコマンド一覧を表示する
   - `~/Documents/Git/ai-toolkit/README.md` を読み込み、「## スラッシュコマンド一覧」セクションの表を抽出して表示する

   ```
   ## 既存コマンド一覧

   （README.mdから抽出した表を表示）

   更新したいコマンドの番号またはコマンド名を入力してください。
   ```

2. ユーザーの選択を受け取る

### Phase 2: 現状分析

3. 選択されたコマンドの関連ファイルを読み込む
   - スラッシュコマンドファイル: `~/Documents/Git/ai-toolkit/slash-commands/{command_name}.md`
   - タスクファイル: `~/Documents/Git/ai-toolkit/task/{command_name}.md`（存在する場合）

4. 現在の構造・内容を分析し、以下の形式でユーザーに提示する

   ```
   ## 現在のコマンド構成

   ### スラッシュコマンド
   - allowed-tools: {tools}
   - description: {description}
   - 役割: {role}

   ### タスクファイル
   - 存在: あり / なし
   - 概要: {task_description}
   - 手順数: {step_count}

   ### テンプレート整合性チェック
   - [OK/NG] フロントマター形式（---で囲まれている）
   - [OK/NG] allowed-toolsが存在する
   - [OK/NG] descriptionが存在する
   - [OK/NG] 役割セクションが存在する
   - [OK/NG] 「日本語で回答すること。」が含まれている
   - [OK/NG] 手順セクションが存在する
   - [OK/NG] 命名規則（kebab-case）に準拠
   ```

### Phase 3: 更新要件の収集

5. ユーザーに以下を質問する

   ```
   このコマンドをどのように更新したいですか？

   以下の情報を教えてください：
   - **更新したい点**: 何を変えたいですか？
   - **理由**: なぜ変更が必要ですか？
   - **期待する結果**: 変更後にどうなってほしいですか？

   例: 「手順3の説明が分かりにくいので、より具体的にしたい」
   例: 「新しいレビュー観点を追加したい」
   例: 「allowed-toolsにMCPツールを追加したい」
   ```

### Phase 4: 更新計画の作成

6. Taskツールを使用してPlanサブエージェントを起動し、更新計画を立案させる

   ```
   ユーザーの更新要件に基づいて、既存コマンドの更新計画を立ててください。

   対象コマンド: {command_name}
   現在の内容:
   {current_content}

   ユーザーの更新要件:
   {update_requirements}

   以下を提案してください：
   1. 変更が必要な箇所の特定
   2. 具体的な変更内容
   3. テンプレートとの整合性確認

   参考テンプレート:
   - スラッシュコマンド: ~/Documents/Git/ai-toolkit/templates/slash-command-template.md
   - タスクファイル: ~/Documents/Git/ai-toolkit/templates/task-template.md
   ```

7. 変更点を差分形式でユーザーに提示する

   ```
   ## 更新計画

   ### 変更概要
   {change_summary}

   ### スラッシュコマンドの変更
   ファイル: slash-commands/{command_name}.md

   ```diff
   - 変更前の行
   + 変更後の行
   ```

   ### タスクファイルの変更
   ファイル: task/{command_name}.md

   ```diff
   - 変更前の行
   + 変更後の行
   ```

   ### テンプレート整合性
   - [OK] 更新後もテンプレートに準拠しています

   この更新でよろしいですか？修正があればお知らせください。
   ```

8. 修正点があれば修正し、承認を得る

### Phase 5: 更新実行

9. ユーザーの承認後、Editツールでファイルを更新する
   - スラッシュコマンドファイル
   - タスクファイル（該当する場合）

10. 更新後のファイル内容全体をユーザーに提示し、最終確認を求める

### Phase 6: 完了

11. README.mdのスラッシュコマンド一覧を更新する
    - `~/Documents/Git/ai-toolkit/README.md` を読み込む
    - 「## スラッシュコマンド一覧」セクション内の該当コマンドの説明を更新する
    - descriptionが変更された場合のみ更新を行う

12. 更新完了の報告をする

    ```
    ## 更新完了

    以下のファイルを更新しました：
    - slash-commands/{command_name}.md
    - task/{command_name}.md
    - README.md（descriptionが変更された場合）

    ### コマンドの使用方法
    `/{command_name}` で呼び出せます。

    ### 変更内容の確認
    `git diff` で変更内容を確認できます。
    ```

## テンプレート整合性チェック

更新時に以下のタスクを実施してテンプレート整合性を確認すること：
- `~/Documents/Git/ai-toolkit/task/command-validation.md`

## 注意事項

- 更新前に必ず現在の内容をユーザーに提示する
- 大幅な構造変更の場合は、`/create-command` での新規作成を提案する
- タスクファイルが存在しない場合（スラッシュコマンド単体のコマンド）にも対応する
- 更新後は `git diff` で変更内容を確認できることを案内する
- 既存のコマンドと重複する名前への変更は避ける
