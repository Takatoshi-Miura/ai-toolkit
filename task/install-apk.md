# install-apk コマンド用タスク

## 概要
PCに接続されたAndroid端末にAPKファイルをインストールする。

## 前提条件
- Android端末がUSBデバッグモードでPCに接続されていること
- adbコマンドが利用可能であること

## 手順

### Step 1: 接続端末の確認
1. `adb devices` コマンドを実行して、接続されているAndroid端末を確認する
2. 結果をユーザーに表示する

### Step 2: 端末の選択
- 接続端末が **0台** の場合:
  - 「Android端末が接続されていません」と表示
  - 以下を案内する:
    - USBケーブルで端末をPCに接続してください
    - 端末のUSBデバッグモードが有効になっているか確認してください
    - 端末に「USBデバッグを許可しますか？」のダイアログが表示されていれば許可してください
  - ユーザーが準備できたら `adb devices` を再実行して確認する
- 接続端末が **1台** の場合: 自動的にその端末を選択
- 接続端末が **2台以上** の場合: ユーザーに選択させる
  - デバイスIDと接続状態を一覧表示
  - 番号で選択できるようにする

### Step 3: APKファイルの確認
1. デフォルトのAPKパスを確認する
   - パス: `/Users/takatoshi.miura/Downloads/app-develop-debug.apk`
2. ファイルが存在するか確認する（`ls -la` でファイル情報を取得）
3. **ファイルが存在する場合**:
   - ファイル名、サイズ、更新日時をユーザーに表示
   - 「このAPKをインストールしますか？」と確認
   - 別のAPKを使用したい場合はパスを指定してもらう
4. **ファイルが存在しない場合**:
   - `/Users/takatoshi.miura/Downloads/` 内の `.apk` ファイルを検索して一覧表示
   - 見つかった場合は選択させる
   - 見つからない場合はAPKファイルのパスを入力してもらう

### Step 4: インストールの実行
1. 以下のコマンドでAPKをインストールする
   ```bash
   adb -s <デバイスID> install -r <APKファイルパス>
   ```
   - `-r` オプション: 既存アプリを上書きインストール（再インストール）

2. インストール結果を確認する
   - **成功時**: 「インストールが完了しました」と表示
   - **失敗時**: エラーメッセージを表示し、考えられる原因と対処法を提案

### Step 5: 結果の報告
インストール結果をサマリーとして表示する:
- インストール先端末のデバイスID
- インストールしたAPKファイル名
- インストール結果（成功/失敗）

## エラーハンドリング

| エラー状況 | 対処法 |
|-----------|--------|
| 端末未接続 | USBケーブルの接続確認、USBデバッグ有効化の確認を促す |
| APKファイル不存在 | 正しいパスの入力を促す、Downloadsフォルダを検索 |
| インストール失敗 (INSTALL_FAILED_*) | エラーコードに応じた対処法を提示 |
| 端末がオフライン状態 | 端末でUSBデバッグの許可ダイアログを確認するよう促す |

## よくあるadbインストールエラーと対処法
- `INSTALL_FAILED_ALREADY_EXISTS`: `-r` オプションで上書きインストール（本コマンドでは対応済み）
- `INSTALL_FAILED_INSUFFICIENT_STORAGE`: 端末のストレージ空き容量を確認
- `INSTALL_FAILED_UPDATE_INCOMPATIBLE`: 既存アプリをアンインストールしてから再インストール
- `INSTALL_FAILED_VERSION_DOWNGRADE`: 古いバージョンはインストールできないため、端末のアプリをアンインストール
