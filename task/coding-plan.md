# codingコマンド用 実装計画を立てるタスク

## 概要
Planサブエージェントを使用して、実装計画を作成・承認するタスク。
コード分析と実現可能性評価を含む詳細な実装計画を立案します。

## 手順

### Phase 1: Planサブエージェントの起動

Taskツールで Plan サブエージェントを起動する。

**起動パラメータ**:
```
subagent_type: "Plan"
prompt: 以下の情報を含める
  - 実装内容の概要（収集した仕様情報）
  - 参照すべき仕様書・設計書の情報
  - プロジェクトのCLAUDE.mdのパス
```

**サブエージェントへの指示内容**:

1. **不明点の解消**
   - 仕様、実装内容、タスクスコープについて不明点があればユーザーに質問
   - 不明点がなくなるまで質問を繰り返す

2. **既存実装の調査**
   - 既存の類似実装パターンを調査
   - 類似実装がある場合はそのパターンを踏襲

3. **修正対象の特定**
   - 修正が必要なファイルを特定
   - 影響範囲を明確化

4. **実装方針の策定**
   - CLAUDE.mdの規約に従う
   - タスクスコープを明確にし、過剰な実装を避ける
   - 不具合修正の場合は根本原因をコードレベルで分析

### Phase 2: 実装計画の出力

Planサブエージェントは以下の形式で実装計画を出力すること:

```markdown
## 実装計画

### 1. 概要
- **目的**: （実装の目的を1-2文で）
- **スコープ**: （対象範囲を明確に）
- **除外事項**: （今回対象外とするもの）

### 2. 前提条件
- （実装に必要な前提条件を箇条書き）

### 3. 修正対象ファイル

| ファイルパス | 変更種別 | 変更概要 |
|-------------|---------|---------|
| path/to/file1.kt | 修正 | メソッド追加 |
| path/to/file2.kt | 新規 | 新規クラス作成 |

### 4. 実装ステップ

#### Step 1: （ステップ名）
- **対象ファイル**: path/to/file.kt
- **変更内容**:
  - （具体的な変更内容を箇条書き）
- **依存関係**: （他のステップとの依存があれば記載）

#### Step 2: （ステップ名）
- ...

### 5. 類似実装の参照
- **参照ファイル**: path/to/reference.kt
- **参照理由**: （なぜこのファイルを参照するか）
- **踏襲するパターン**: （どのパターンを踏襲するか）

### 6. リスク・注意点
- （実装時の注意点を箇条書き）

### 7. メリット・デメリット

**この計画のメリット**:
- （メリットを箇条書き）

**この計画のデメリット**:
- （デメリットを箇条書き）

### 8. 代替案（あれば）
- （検討した代替案とその理由）
```

### Phase 3: ユーザー承認

1. 実装計画をユーザーに提示
2. 以下の観点で承認を求める:
   - スコープは適切か
   - 修正対象ファイルは正しいか
   - 実装ステップは妥当か
   - リスク・注意点に漏れはないか

3. 承認されない場合:
   - フィードバックを受け取る
   - Phase 1に戻り、計画を修正
   - 再度承認を求める

4. 承認された場合:
   - 本タスク完了
   - 次のタスク（coding-implementation.md）へ進む

## 出力要件

- 実装計画は上記フォーマットに従うこと
- 不明点を残したまま計画を確定しないこと
- ユーザー承認を得るまで繰り返すこと

## 注意事項

- テストコードの生成は計画に含めない（Phase 5で別途対応）
- 過剰な改善提案は避け、要求されたスコープに集中する
- 既存コードのスタイルを尊重する
