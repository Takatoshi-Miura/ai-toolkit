# review-pull-request タスク

## 概要
GitHub PRをレビューする。コード変更の品質・設計・セキュリティ等を多角的に確認する。

## 前提条件
- レビュー対象のPR URLが提供されていること
- PRのブランチにチェックアウト済み、またはチェックアウト可能であること

## 手順

### Phase 1: 情報収集

1. 追加情報を質問して提供してもらう（任意）
    - PBIのURL
    - 概要設計書のURL
    - テスト項目書のURL

2. PRレビュー対象のブランチにチェックアウトされているか確認し、されていなければユーザーに要求する

3. PRを `gh pr view` コマンドで読み取る
    ```bash
    # PR情報の取得（タイトル、説明、状態など）
    gh pr view <PR番号> --repo owner/repo

    # 変更差分の取得
    gh pr diff <PR番号> --repo owner/repo
    ```

4. 1で追加情報が提供されていれば、mcpを使用して情報を読み取る
    - **Google Drive の場合**: `/read-google-drive-skill` で読み取る
    - **注意**: `g_drive_search_files`は使用しない(ファイルIDがURLから取得可能なため)

### Phase 2: コードレビュー

5. 関連するプロジェクトのコードを読み取り、PRの変更差分(diff)を確認し、変更されたファイルと行のみをレビュー対象とする

6. 「PRレビュー観点」に従ってレビューを実施し、結果をユーザーに共有する

---

## PRレビュー観点

### 1. 変更の目的・スコープ
* PRタイトル・説明と実装内容が一致している
* 変更範囲が目的に対して最小限である
* 不要な変更（インデント変更・無関係なリファクタ）が含まれていない
* 削除されたコード・関数の理由が明確で、他箇所への悪影響がない

### 2. 仕様・ロジック・データ整合性（デグレ防止含む）
* 実装が Issue・仕様書・PR説明と整合している
* 推測による実装や曖昧な処理がない
* データフロー（登録→更新→削除等）に矛盾がない
* null・空値・境界値（最大/最小）を適切に処理している
* 既存画面や機能を壊していない（デグレなし）
* 条件分岐や例外処理を削除した影響が適切に考慮されている
* API・ライブラリ変更による互換性が保たれている

### 3. Androidプラットフォーム／ライフサイクル
* Activity / Fragment / Service 等のライフサイクルを正しく扱っている
* 画面回転・バックグラウンド復帰・低メモリなど OS イベントで安定動作する
* Context, Drawable, String 等のリソースが適切に管理されている（リークなし）
* Jetpack アーキテクチャコンポーネントの利用が推奨パターンに沿っている
* Main/IO スレッド切り替えが適切
* プロセス終了やマルチウィンドウなどで状態が正しく保持・復元される
* Coroutine とライフサイクルの連携が適切（キャンセル漏れがない）

### 4. 画面遷移・状態管理・非同期処理

#### 4.1 画面遷移
* 画面遷移・戻る動作・状態遷移に一貫性がある
* Bundle / Intent / Navigation Args 等のデータ受け渡しが安全
* 二重タップ・多重遷移が防止されている
* バックスタック復帰時に状態が正しく維持される
* Deep Link 対応が適切（該当する場合）

#### 4.2 登録・更新フロー
* ローディング状態の管理が適切
* 二重送信防止が実装されている（ボタン disable、リクエスト重複防止等）
* 成功・失敗時の UI 遷移とエラーハンドリングが適切
* オフライン時の処理が考慮されている（該当する場合）

#### 4.3 非同期処理とキャンセル
* 適切な Coroutine スコープ（lifecycleScope など）が選択されている
* ライフサイクル終了時に処理がキャンセルされている
* finally / onCancellation など後処理が保証されている
* 長時間処理にタイムアウトが設定されている（必要な場合）
* 不正状態・レースコンディションが発生しない設計になっている

#### 4.4 入力・フォーカス管理
* 入力値の検証・整形が適切なタイミングで行われている
* ソフトキーボードの表示・非表示制御が自然
* 入力エラー時に適切なフィードバックが行われる
* Galaxy端末のIME(キーボード入力)で問題が発生しないか
  - 予測変換・自動補完の挙動が正常
  - 入力確定タイミング(composing状態からcommit時)の処理が適切
  - テキスト入力中のフィルタリング・リアルタイム検証が正しく動作
  - 長押しによる特殊文字入力・記号入力が正常に機能

#### 4.5 フォアグラウンド復帰時
* 復帰時に必要なデータ再読み込みが行われている
* 認証状態の確認・再同期が適切
* UI状態（スクロール位置・入力中データ等）が復元されている

### 5. UI/UX・ユーザビリティ
* エラーメッセージの文言が仕様通りで正確
* ローディング・エラー表示のタイミングが自然（チラつきなどがない）
* ボタンの活性/非活性制御が適切
* エラー状態のクリアタイミング（再試行時・遷移時）が適切

### 6. 設計・可読性・保守性
* 命名・フォーマット・ディレクトリ構成が一貫している
* 冗長なロジック・重複コードがない（DRY）
* 責務分離が適切（UI・ドメイン・データ層の役割が明確）
* 例外処理の扱いが適切（層を跨がず、握る箇所が適切）
* 将来的な拡張性・変更容易性が考慮されている
* コメント・ドキュメントが必要十分に記述されている
* 技術的負債を増やしていない、または改善が行われている

### 7. テスト
* テストコードが存在し、主要分岐・エッジケースをカバーしている
* null / 最大値 / 最小値 / 空データなど境界値テストが含まれている
* 既存テストが仕様変更に合わせて更新されている
* デグレ防止に役立つテスト（回帰テスト等）が整備されている

### 8. セキュリティ
* パスワード・トークンなど機密情報がログや画面に露出していない
* 機密データの保存が暗号化されている（SharedPreferences・DB等）
* 入力値が適切に検証・サニタイズされている
* 認証・認可チェックが適切
* セキュア通信（HTTPS / ピンニング）に問題がない

### 9. パフォーマンス・リソース
* メインスレッドで重い処理を実行していない
* 不必要な再描画・再計算が発生していない
* RecyclerViewの最適化（ViewHolder再利用・DiffUtil等）が行われている
* 画像読み込みが最適化されている（キャッシュ・リサイズ等）
* メモリ使用量が適切、大量データ処理でOOMの危険がない
* メモリリーク（Context保持、リスナー未解除等）が発生していない
* ネットワーク通信が最適化されている（キャッシュ・バッチ等）

### 10. その他（自由な発想でのレビュー）
**以下の観点を参考に、上記カテゴリーに当てはまらない気づきや改善提案を自由に行う:**
* 可読性・理解しやすさの改善余地
* より良い実装方法やライブラリの提案
* レアケース・エッジケースの漏れ
* ダークモード対応
* 他画面・他機能との整合性
* ビルド・テスト時間への影響
