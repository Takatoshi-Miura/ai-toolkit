# プルリクエスト(PR)をレビューするタスク

## 手順
1. 以下の情報が提供されていなければユーザーに質問して提供してもらう
    - PRのURL（必須）
    - PBIのURL（任意）
    - 概要設計書のURL（任意）
    - テスト項目書のURL（任意）
2. PRレビュー対象のブランチにチェックアウトされているか確認し、されていなければユーザーに要求する
3. PRをmcp-githubのget_pull_requestツールで読み取る
4. 1でPRのURL以外の情報が提供されていれば、mcpを使用して情報を読み取る
5. 関連するプロジェクトのコードを読み取り、PRの変更差分(diff)を確認し、変更されたファイルと行のみをレビュー対象とする
6. 以下の「レビュー観点」に従ってレビューを実施し、結果をユーザーに共有する

## レビュー観点

### 1. 変更の意図と整合性
* [ ] PRタイトル・説明と実装内容が一致している
* [ ] 変更範囲が目的に対して最小限である
* [ ] 不要な変更（インデント・リファクタ目的以外）が含まれていない
* [ ] 削除されたコード・関数の理由が明確で、他箇所に影響しない

### 2. デグレ・既存機能の後退防止
* [ ] 既存画面や機能の動作に悪影響がない
* [ ] 条件分岐・例外処理削除による影響がない
* [ ] APIやライブラリ変更が動作・互換性を壊していない
* [ ] 画面回転、バックグラウンド復帰、低メモリ状態でも正常動作
* [ ] DBスキーマや設定キー変更によるデータ互換性が保たれている

### 3. 仕様理解とロジック整合性
* [ ] 実装がIssue・仕様書・PR説明と整合している
* [ ] 「おそらくこうだろう」という推測実装がない
* [ ] 登録→更新→削除などのデータフローに矛盾がない
* [ ] 画面遷移・状態遷移・戻る動作に一貫性がある
* [ ] 空値・null・境界値（最大/最小）を正しく処理している

### 4. Android特有の観点
* [ ] スレッド切り替え（Main/IO Dispatcher）が適切
* [ ] Jetpack（Compose・Navigation・Hilt・Room・ViewModel等）の利用が推奨パターンに沿っている
* [ ] Context、Drawable、Stringリソースの解放忘れがない
* [ ] Activity/Fragment/ViewModel/Coroutineのライフサイクルを正しく扱っている
* [ ] 画面回転・プロセス終了後も状態が正しく保持・復元される

### 5. 画面遷移・状態管理

#### 5.1 画面遷移
* [ ] データ受け渡しが安全（Bundle / NavArgs / SafeArgsなど）
* [ ] 二重タップ・多重遷移が防止されている
* [ ] バックスタック復帰時に状態が維持される

#### 5.2 登録・更新処理
* [ ] ローディング状態（isLoading等）が適切に制御されている
* [ ] 二重送信防止（ボタン無効化・重複リクエスト防止）が実装されている
* [ ] 成功・失敗時のUI遷移やエラーハンドリングが適切

#### 5.3 非同期処理とキャンセル
* [ ] lifecycleScope / viewModelScopeが正しく選択されている
* [ ] onDestroyView / onClearedでキャンセルが行われている
* [ ] finally / onCancellationで後処理が保証されている
* [ ] 長時間処理にタイムアウトが設定されている

#### 5.4 入力とフォーカス管理
* [ ] フォーカス移動時に入力値の検証・整形が行われている
* [ ] ソフトキーボードの表示・非表示制御が自然
* [ ] 入力エラー時にエラーフィールドへ自動フォーカス

#### 5.5 フォアグラウンド復帰時処理
* [ ] onResume / onStartでデータ再読み込みが行われている
* [ ] トークン期限切れ・バックグラウンド中の変更への再同期がある
* [ ] 復帰時にスクロール位置・入力中データが復元される

#### 5.6 状態遷移の整合性
* [ ] ViewModelのStateとUIが常に同期している
* [ ] isLoading / hasError / isEmpty等の状態フラグに矛盾がない
* [ ] 不正状態・レースコンディションが発生しない

### 6. 品質・保守性・テスト
* [ ] 命名・フォーマット・構造が既存コードと一貫している
* [ ] 冗長なロジック・重複コードがない
* [ ] null安全性・例外処理が適切
* [ ] テストコードが存在し、重要な分岐やエッジケースをカバーしている
* [ ] 境界値テスト（0, null, 最大値、最小値）が含まれている

### 7. 改善提案
* [ ] 設計改善（より安全・拡張しやすい構成の提案）
* [ ] パフォーマンス最適化（不要な再描画・再計算の検知）
* [ ] テスト強化（不足テストケースの提案）
* [ ] 保守性向上（将来変更を見据えたリファクタ提案）

### 8. UI/UX・ユーザビリティ
* [ ] エラーメッセージの文言が仕様書・設計書と一致している
* [ ] エラーメッセージが具体的で、ユーザーが次のアクションを理解できる
* [ ] ローディング表示やエラー表示のタイミングが適切
* [ ] ボタンの活性/非活性制御が適切
* [ ] エラー状態のクリアタイミングが適切（再試行時、画面遷移時など）