---
name: write-google-drive-skill
description: Google Driveファイル（スプレッドシート、ドキュメント、スライド）への書き込みをPythonスクリプトで実行。値挿入、シート/スライド作成、要素コピー、セル結合に対応。「ドライブに書いて」「スプレッドシートに追加」「シート作成」「セル結合」「スライド追加」などの依頼で使用。
allowed-tools: Bash
user-invocable: true
---

# Google Drive ファイル書き込みスキル

Google Driveのスプレッドシート、ドキュメント、スライドにPythonスクリプトで書き込む。

## 重要：このスキルの使い方

**必ず以下のチェックリストをコピーして、各ステップを順番に実行すること。**
ステップを飛ばしたり、チェックリストなしで進めてはならない。

**制約事項：**
- このスキルはPythonスクリプト（`scripts/` 配下）のみを使用する
- Google Drive関連のMCPツールは使用しない
- 認証エラーが発生した場合は、[SETUP.md](SETUP.md) のセットアップワークフローを実行する

## ワークフロー選択

まず状況を判断する：

- **初めて使用する / 認証エラーが発生した？** → [SETUP.md](SETUP.md) を参照
- **値/テキストを挿入したい？** → 「値挿入ワークフロー」へ
- **新規シート/スライドを作成したい？** → 「新規作成ワークフロー」へ
- **シート/スライドをコピーしたい？** → 「コピーワークフロー」へ
- **セルを結合したい？** → 「セル結合ワークフロー」へ
- **複数セルを一括結合したい？** → 「セル一括結合ワークフロー」へ

---

## 値挿入ワークフロー

**【必須】** このチェックリストをコピーして進行状況を追跡（省略不可）：

```
値挿入進捗：
- [ ] ステップ1：URLからファイルIDとタイプを抽出
- [ ] ステップ2：挿入内容と位置を決定
- [ ] ステップ3：スクリプトを実行
- [ ] ステップ4：結果を確認（エラー時は対応）
```

### ステップ1：URLからファイルIDとタイプを抽出

URLパターンから `{fileId}` を抽出し、ファイルタイプを特定：

| URL | fileType |
|-----|----------|
| `docs.google.com/spreadsheets/d/{fileId}/edit` | `sheets` |
| `docs.google.com/document/d/{fileId}/edit` | `docs` |
| `docs.google.com/presentation/d/{fileId}/edit` | `presentations` |

### ステップ2：挿入内容と位置を決定

| fileType | target | content |
|----------|--------|---------|
| sheets | 範囲（例: `Sheet1!A1`） | JSON配列（例: `[["値1","値2"]]`） |
| docs | 文字位置（`-1`で末尾） | テキスト |
| presentations | スライド番号（0始まり） | テキスト |

### ステップ3：スクリプトを実行

```bash
python3 scripts/insert_value.py <fileId> <fileType> <target> <content> [options]
```

**オプション：**
- `--append`: sheets で末尾に追加
- `--bounds '{"x":100,"y":100,"width":400,"height":100}'`: presentations でテキストボックスの位置指定
- `--tab-id <tabId>`: docs でタブ指定

### ステップ4：結果を確認

**成功時**: `"success": true` が出力される → 完了

**エラー時**: [WRITING.md](WRITING.md) のエラー対応を参照

---

## 新規作成ワークフロー

**【必須】** このチェックリストをコピーして進行状況を追跡（省略不可）：

```
新規作成進捗：
- [ ] ステップ1：URLからファイルIDとタイプを抽出
- [ ] ステップ2：新規要素の名前を決定
- [ ] ステップ3：スクリプトを実行
- [ ] ステップ4：結果を確認
```

### ステップ1：URLからファイルIDとタイプを抽出

（値挿入ワークフローと同じ）

### ステップ2：新規要素の名前を決定

| fileType | 作成対象 |
|----------|----------|
| sheets | 新規シート |
| presentations | 新規スライド |
| docs | ⚠️ API制限により未サポート |

### ステップ3：スクリプトを実行

```bash
python3 scripts/create_element.py <fileId> <fileType> <name>
```

### ステップ4：結果を確認

**成功時**: `"success": true` と新規要素のIDが出力される → 完了

---

## コピーワークフロー

**【必須】** このチェックリストをコピーして進行状況を追跡（省略不可）：

```
コピー進捗：
- [ ] ステップ1：URLからファイルIDとタイプを抽出
- [ ] ステップ2：コピー元のIDを特定
- [ ] ステップ3：スクリプトを実行
- [ ] ステップ4：結果を確認
```

### ステップ1：URLからファイルIDとタイプを抽出

（値挿入ワークフローと同じ）

### ステップ2：コピー元のIDを特定

| fileType | sourceId の形式 |
|----------|-----------------|
| sheets | シートID（数値） |
| presentations | スライドオブジェクトID（文字列） |

**シートIDの確認方法**: スプレッドシートを開いた時のURLの `#gid=123456` の数値部分

### ステップ3：スクリプトを実行

```bash
python3 scripts/copy_element.py <fileId> <fileType> <sourceId> [newName]
```

### ステップ4：結果を確認

**成功時**: `"success": true` とコピー先のIDが出力される → 完了

---

## セル結合ワークフロー

**【必須】** このチェックリストをコピーして進行状況を追跡（省略不可）：

```
セル結合進捗：
- [ ] ステップ1：URLからファイルIDを抽出
- [ ] ステップ2：結合範囲を決定
- [ ] ステップ3：スクリプトを実行
- [ ] ステップ4：結果を確認
```

### ステップ1：URLからファイルIDを抽出

スプレッドシートのURLから `{fileId}` を抽出

### ステップ2：結合範囲を決定

形式: `シート名!開始セル:終了セル`（例: `Sheet1!A1:B2`）

### ステップ3：スクリプトを実行

```bash
python3 scripts/merge_cells.py <fileId> <range>
```

### ステップ4：結果を確認

**成功時**: `"success": true` が出力される → 完了

---

## セル一括結合ワークフロー

**【必須】** このチェックリストをコピーして進行状況を追跡（省略不可）：

```
セル一括結合進捗：
- [ ] ステップ1：URLからファイルIDを抽出
- [ ] ステップ2：結合範囲のリストを作成
- [ ] ステップ3：スクリプトを実行
- [ ] ステップ4：結果を確認
```

### ステップ1：URLからファイルIDを抽出

スプレッドシートのURLから `{fileId}` を抽出

### ステップ2：結合範囲のリストを作成

JSON配列形式で結合したい範囲をすべてリストアップ：

```json
["シート名!A4:A10", "シート名!A11:A20", "シート名!B4:B8"]
```

### ステップ3：スクリプトを実行

```bash
python3 scripts/merge_cells_batch.py <fileId> '<json_ranges>'
```

**例：**
```bash
python3 scripts/merge_cells_batch.py 1abc...xyz '["Sheet1!A4:A10","Sheet1!B4:B8","Sheet1!C4:C15"]'
```

### ステップ4：結果を確認

**成功時**: `"success": true` と結合された範囲数（`totalRanges`）が出力される → 完了

**エラー時**: `validationErrors` で問題の範囲を確認し、修正して再実行

---

## 詳細リファレンス

- **使用例・出力形式**: [WRITING.md](WRITING.md)
- **セットアップ・トラブルシューティング**: [SETUP.md](SETUP.md)
