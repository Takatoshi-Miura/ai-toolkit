# モバイルアプリ開発ワークフロー

モバイルアプリ開発プロジェクトの実装タスクを、情報収集から実装・テストまで一連のPhaseで進行する。

## TodoWrite登録

```json
[
  {"content": "Phase 1: 情報収集", "activeForm": "情報を収集中", "status": "pending"},
  {"content": "Phase 2: 実装計画", "activeForm": "実装計画を策定中", "status": "pending"},
  {"content": "Phase 3: 実装", "activeForm": "コードを実装中", "status": "pending"},
  {"content": "Phase 4: テスト（条件付き）", "activeForm": "テストを作成中", "status": "pending"},
  {"content": "Phase 5: 完了処理", "activeForm": "完了処理中", "status": "pending"}
]
```

---

## Phase 1: 情報収集

### 1-1. ユーザーへの質問

AskUserQuestionツールで以下を収集:

| 項目 | 必須 | 例 |
|------|------|-----|
| RedmineチケットURL | ✅ | https://redmine.example.com/issues/12345 |
| 概要設計書URL | ❌ | Google Drive URL |
| テスト項目書URL | ❌ | Google Drive URL（シート名指定可） |
| 実装したいこと | ❌ | 追加の共有事項 |

### 1-2. 外部データの読み取り

**Redmineチケット**: `/redmine-skill` で読み取り（チケット番号、タイトル、詳細を取得）

**概要設計書・テスト項目書**（指定がある場合）: `/google-drive-skill` で読み取り

### 1-3. 情報の整理

収集した情報を整理し、次のPhaseに引き継ぐ。

**成功確認**: 必要な情報がすべて揃った → Phase 2へ

---

## Phase 2: 実装計画

### 2-1. Plan サブエージェントの呼び出し

Taskツールで `Plan` サブエージェントを起動:

```
subagent_type: "Plan"
prompt: |
  以下の情報に基づいて実装計画を立ててください。

  ## 実装内容
  {Redmineチケットの詳細、概要設計書の内容}

  ## 参照情報
  - CLAUDE.mdのパス: {プロジェクトのCLAUDE.md}
  - 概要設計書: {概要設計書の内容}

  ## 作成してほしいもの
  1. 不明点があればユーザーに質問（解消するまで繰り返し）
  2. 既存の類似実装パターン調査
  3. 修正対象ファイルの特定
  4. 実装方針の策定
```

### 2-2. 実装計画の出力フォーマット

Planサブエージェントは以下の形式で出力:

```markdown
## 実装計画

### 1. 概要
- **目的**: （1-2文）
- **スコープ**: （対象範囲）
- **除外事項**: （今回対象外）

### 2. 前提条件

### 3. 修正対象ファイル
| ファイルパス | 変更種別 | 変更概要 |
|-------------|---------|---------|

### 4. 実装ステップ
#### Step N: （ステップ名）
- **対象ファイル**: path/to/file.kt
- **変更内容**: （箇条書き）
- **依存関係**: （他ステップとの依存）

### 5. 類似実装の参照
### 6. リスク・注意点
### 7. メリット・デメリット
### 8. 代替案（あれば）
```

### 2-3. ユーザー承認

1. 実装計画をユーザーに提示
2. スコープ・修正対象・実装ステップ・リスクの観点で承認を求める
3. 承認されない場合 → 2-1に戻り計画を修正
4. 承認された場合 → Phase 3へ

**成功確認**: ユーザーが実装計画を承認 → Phase 3へ

---

## Phase 3: 実装

### 3-1. code-implementer サブエージェントの呼び出し

Taskツールで `code-implementer` サブエージェントを起動:

```
subagent_type: "code-implementer"
prompt: |
  以下の実装計画に従ってコードを実装してください。

  ## 承認された実装計画
  {Phase 2で承認された計画}

  ## 修正対象ファイル
  {ファイルパスのリスト}

  ## プロジェクト規約
  CLAUDE.md: {パス}
```

サブエージェントが実行するタスク:
- 実装計画に従ったコード実装
- ビルド実行・エラー修正
- 実装完了の報告

### 3-2. 実装結果の確認

- サブエージェントからの報告を確認
- 問題があれば再度サブエージェントに指示

**成功確認**: ビルド成功・実装完了 → Phase 4へ

---

## Phase 4: テスト（条件付き）

### 4-1. テスト必要性の判定

**テスト不要**: 既存共通クラスの呼び出しのみ / 既存テストで十分カバー / UIの軽微な変更のみ

**テスト必要**: 新規ビジネスロジック / 複雑な条件分岐 / 外部API連携の追加

### 4-2. test-writer サブエージェントの呼び出し（テスト必要時のみ）

Taskツールで `test-writer` サブエージェントを起動:

```
subagent_type: "test-writer"
prompt: |
  以下のコードに対してテストを作成してください。

  ## テスト対象
  {Phase 3で実装したコードのパス}

  ## テスト要件
  - カバレッジ目標: 90%
  - テストフレームワーク: {プロジェクトで使用しているもの}

  ## プロジェクト規約
  CLAUDE.md: {パス}
```

**成功確認**: テスト不要と判定 or テスト実行成功 → Phase 5へ

---

## Phase 5: 完了処理

### 5-1. 最終確認

- 全Phaseの完了を確認
- TodoWriteで全項目がcompletedになっていることを確認

### 5-2. 総評の作成

以下の観点で報告:

```markdown
## 総評

### 今回のタスクでうまくいった点
- （箇条書き）

### 改善が必要だった点
- （箇条書き）

### プロンプトへの修正提案（あれば）
- （具体的な修正提案）
```

---

## 注意事項

- テストコードの生成はPhase 4で別途対応（Phase 2の計画には含めない）
- 過剰な改善提案は避け、要求されたスコープに集中する
- 既存コードのスタイルを尊重する
