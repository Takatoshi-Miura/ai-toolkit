# Skill作成ベストプラクティス

Skillの作成に関する公式ベストプラクティスをまとめたリファレンスです。

## 目次

1. [共通原則](#共通原則)
2. [Skill](#skill)
3. [使い分けガイド](#使い分けガイド)
4. [要件収集テンプレート](#要件収集テンプレート)
5. [設計案提示フォーマット](#設計案提示フォーマット)

---

## 共通原則

### Description の重要性

Claudeは **descriptionだけ** を読んで自動選択・タスク委譲を判断します。

**必須要素**:
1. **何をするか**: 具体的なアクション
2. **いつ使うか**: 使用タイミング・トリガーコンテキスト

**常に三人称で書く**（説明はシステムプロンプトに挿入されるため）:
- ✅ 良い：「Excelファイルを処理してレポートを生成します」
- ❌ 避ける：「Excelファイルの処理をお手伝いできます」
- ❌ 避ける：「これを使用してExcelファイルを処理できます」

**❌ 悪い例**:
```yaml
description: Helps with documents
```

**✅ 良い例**:
```yaml
description: PDFファイルからテキストや表を抽出し、フォーム入力やドキュメント結合を行う。PDFファイルの処理を依頼された時、または「PDF」「フォーム」「抽出」などのキーワードが含まれる場合に使用。
```

### 簡潔さが鍵

コンテキストウィンドウは共有リソースです。情報の各部分に問いかけてください：
- 「Claudeは本当にこの説明が必要か？」
- 「Claudeがこれを知っていると仮定できるか？」
- 「このパラグラフはそのトークンコストに見合う価値があるか？」

**デフォルトの仮定**: Claudeはすでに非常に賢い。Claudeが既に持っていないコンテキストのみを追加する。

### 命名規則

**小文字・数字・ハイフンのみ**（kebab-case）

✅ 良い例: `code-reviewer`, `pdf-processor`, `git-commit`
❌ 悪い例: `CodeReviewer`, `pdf_processor`, `helper`, `utils`

**動名詞形を推奨**（動詞 + -ing）:
- `processing-pdfs`
- `analyzing-spreadsheets`
- `testing-code`

---

## Skill

### 配置場所

| 場所 | パス | 適用対象 |
|------|------|---------|
| 個人 | `~/.claude/skills/` | すべてのプロジェクト |
| プロジェクト | `.claude/skills/` | リポジトリメンバー |

### 基本構造

```markdown
---
name: pdf-processor
description: PDFファイルからテキストや表を抽出。「PDF」「抽出」などのキーワードで自動適用。
allowed-tools: Read, Bash
user-invocable: true
---

# PDF処理スキル

## 概要
PDFファイルを処理するスキルです。

## 発動条件
- PDFファイルの処理を依頼された時
- 「PDF」「抽出」などのキーワードが含まれる場合

## 手順
1. ファイルを確認
2. 処理を実行
```

### フロントマターフィールド

| フィールド | 必須 | 説明 |
|-----------|------|------|
| `name` | ✅ | 最大64文字、小文字・数字・ハイフンのみ、予約語不可（anthropic, claude） |
| `description` | ✅ | 最大1024文字、何をするか・いつ使用するか、XMLタグ不可 |
| `allowed-tools` | ❌ | 許可なしで使用できるツール |
| `model` | ❌ | 使用するモデル（sonnet/opus/haiku/inherit） |
| `context` | ❌ | `fork`でサブエージェント実行 |
| `user-invocable` | ❌ | スラッシュメニュー表示（デフォルト: true） |
| `hooks` | ❌ | ライフサイクルフック定義 |

### 段階的開示パターン

**SKILL.mdは500行以下に保つ**。詳細は別ファイルに分離。

```
my-skill/
├── SKILL.md          # 概要とクイックスタート（500行以下）
├── REFERENCE.md      # 詳細リファレンス
├── EXAMPLES.md       # 使用例
└── scripts/          # ユーティリティスクリプト
```

SKILL.md内でリンク：
```markdown
詳細は [REFERENCE.md](REFERENCE.md) を参照してください。
使用例は [EXAMPLES.md](EXAMPLES.md) を参照してください。
```

**重要**: 深くネストされた参照を避ける。SKILL.mdから**1レベル深い参照**を保つ。

### 可視性制御

| 設定 | スラッシュメニュー | 自動検出 | 用途 |
|------|-----------------|---------|------|
| `user-invocable: true`（デフォルト） | 表示 | ○ | ユーザーが明示的に呼び出し可能 |
| `user-invocable: false` | 非表示 | ○ | Claude自動判断のみ |

### ワークフローとフィードバックループ

複雑な操作を明確なステップに分割し、チェックリストを提供：

````markdown
## ワークフロー

このチェックリストをコピーして進行状況を追跡：

```
タスク進捗：
- [ ] ステップ1：フォームを分析する
- [ ] ステップ2：フィールドマッピングを作成する
- [ ] ステップ3：マッピングを検証する
- [ ] ステップ4：フォームに入力する
- [ ] ステップ5：出力を確認する
```
````

**フィードバックループパターン**: バリデータを実行 → エラーを修正 → 繰り返す

### 時間に敏感な情報を避ける

**❌ 悪い例**:
```markdown
2025年8月前にこれを行っている場合は、古いAPIを使用してください。
```

**✅ 良い例**:
```markdown
## 現在の方法
v2 APIエンドポイントを使用

<details>
<summary>レガシーv1 API（2025-08で廃止）</summary>
...
</details>
```

### MCPツール参照

完全修飾ツール名を使用：`ServerName:tool_name`

```markdown
BigQuery:bigquery_schemaツールを使用してテーブルスキーマを取得します。
GitHub:create_issueツールを使用して問題を作成します。
```

### チェックリスト

#### コア品質
- [ ] `name`は小文字・数字・ハイフンのみ（最大64文字）
- [ ] `description`は「何をするか＋いつ使うか＋トリガー用語」を含む（最大1024文字）
- [ ] `description`は三人称で記述
- [ ] `allowed-tools`は必要最小限
- [ ] SKILL.mdボディは**500行以下**
- [ ] 追加の詳細は別ファイルに分離（必要な場合）
- [ ] ファイル参照は**1レベル深い**（深くネストしない）
- [ ] 発動条件が明確に記載されている
- [ ] 時間に敏感な情報がない（または「古いパターン」セクションに）
- [ ] 全体で一貫した用語
- [ ] 例は抽象的ではなく具体的
- [ ] ワークフローに明確なステップがある
- [ ] 段階的開示が適切に使用されている

#### コードとスクリプト（該当する場合）
- [ ] スクリプトは問題を解決し、Claudeに任せない
- [ ] エラー処理は明示的で有用
- [ ] 「マジックナンバー」がない（すべての値が正当化されている）
- [ ] 必要なパッケージが指示にリストされている
- [ ] スクリプトに明確なドキュメントがある
- [ ] Windowsスタイルのパスがない（すべてフォワードスラッシュ）
- [ ] 重要な操作の検証/確認ステップ
- [ ] 品質が重要なタスクにフィードバックループを含む

#### テスト
- [ ] 少なくとも3つの評価シナリオが作成されている
- [ ] Haiku、Sonnet、Opusでテストされている
- [ ] 実際の使用シナリオでテストされている
- [ ] チームフィードバックが組み込まれている（該当する場合）

---

## 使い分けガイド

| 用途 | 推奨リソース |
|------|-------------|
| 簡潔で頻繁に使うプロンプト | スラッシュコマンド |
| 単一ファイルの指示 | スラッシュコマンド |
| 手動呼び出しが必要 | スラッシュコマンド |
| URL/キーワードで自動発動させたい | Skill |
| 複雑なマルチステップワークフロー | Skill |
| スクリプトやユーティリティが必要 | Skill |
| チームワークフロー標準化 | Skill |
| 専門的思考・独自の観点が必要 | サブエージェント |
| 並列実行・コンテキスト分離が必要 | サブエージェント |
| 特定のツール制限・権限を強制したい | サブエージェント |
| 大量の操作を分離したい | サブエージェント |

### 判断フローチャート

```
ユーザーが明示的に呼び出す？
├─ Yes → スラッシュコマンド
└─ No → 自動発動させたい？
         ├─ Yes → Skill
         └─ No → 専門的処理を委譲？
                  ├─ Yes → サブエージェント
                  └─ No → スラッシュコマンド
```

### メイン会話を使用する場合

- タスクが頻繁なやり取りや反復的な改善が必要
- 複数のフェーズが重要なコンテキストを共有
- 迅速でターゲット化された変更

---

## 要件収集テンプレート

Skill作成時は、以下の情報を収集してください：

```
どのようなSkillを作成したいですか？

以下の情報を教えてください：
- **目的**: このスキルで何を実現したいですか？
- **発動条件**: どのような状況で自動適用されるべきですか？
- **必要なツール**: どのツールへのアクセスが必要ですか？

例: 「PDFファイルを処理する際に自動適用。フォーム入力やデータ抽出を支援」
```

---

## 設計案提示フォーマット

ユーザーとの確認時は、以下のフォーマットで提示してください：

```
## Skill設計案

| 項目 | 内容 |
|------|------|
| スキル名 | {skill_name} |
| 説明 | {description} |
| 許可ツール | {allowed_tools} |

### 発動条件
{trigger_conditions}

### 実行手順
{steps}

### 出力形式
{output_format}

この設計でよろしいですか？修正があればお知らせください。
```

---

## 参考リンク

- [公式: Skills Overview](https://platform.claude.com/docs/ja/agents-and-tools/agent-skills/overview)
- [公式: Skills Best Practices](https://platform.claude.com/docs/ja/agents-and-tools/agent-skills/best-practices)
